"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[1996],{7795:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>p,frontMatter:()=>a,metadata:()=>s,toc:()=>d});var r=t(5893),i=t(1151);const a={id:"solution-upgrade-fncm",sidebar_position:1,title:"Upgrade"},o=void 0,s={id:"Create/Upgrade/solution-upgrade-fncm",title:"Upgrade",description:"Upgrading FNCM in the cluster",source:"@site/docs/3-Create/Upgrade/upgrade.mdx",sourceDirName:"3-Create/Upgrade",slug:"/Create/Upgrade/",permalink:"/solution-filenet-aws/Create/Upgrade/",draft:!1,unlisted:!1,editUrl:"https://github.com/ibm-client-engineering/solution-filenet-aws/tree/main/packages/create-docusaurus/templates/shared/docs/3-Create/Upgrade/upgrade.mdx",tags:[],version:"current",sidebarPosition:1,frontMatter:{id:"solution-upgrade-fncm",sidebar_position:1,title:"Upgrade"},sidebar:"tutorialSidebar",previous:{title:"Upgrade",permalink:"/solution-filenet-aws/category/upgrade"},next:{title:"Automate",permalink:"/solution-filenet-aws/Create/solution-automate"}},c={},d=[{value:"Upgrading FNCM in the cluster",id:"upgrading-fncm-in-the-cluster",level:2},{value:"Upgrading the operator manually",id:"upgrading-the-operator-manually",level:3},{value:"Upgrading FNCM containers",id:"upgrading-fncm-containers",level:3},{value:"Secret menu items",id:"secret-menu-items",level:3}];function l(e){const n={a:"a",admonition:"admonition",code:"code",div:"div",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,i.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"upgrading-fncm-in-the-cluster",children:"Upgrading FNCM in the cluster"}),"\n",(0,r.jsxs)(n.p,{children:["Download the most recent IBM Case file for FileNet Content Manager. As of this writing it is v1.7.1. You can check for newer versions by going ",(0,r.jsx)(n.a,{href:"https://github.com/IBM/cloud-pak/tree/master/repo/case/ibm-cp-fncm-case",children:"here"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"wget https://github.com/IBM/cloud-pak/raw/master/repo/case/ibm-cp-fncm-case/1.7.1/ibm-cp-fncm-case-1.7.1.tgz\n"})}),"\n",(0,r.jsx)(n.p,{children:"Extract the case file"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"tar zxvf ibm-cp-fncm-case-1.7.1.tgz\n"})}),"\n",(0,r.jsx)(n.p,{children:"Change into the operator directory and extract the container samples file"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"cd ibm-cp-fncm-case/inventory/fncmOperator/files/deploy/crs/\n\ntar xvf container-samples-5.5.11.tar\n"})}),"\n",(0,r.jsx)(n.h3,{id:"upgrading-the-operator-manually",children:"Upgrading the operator manually"}),"\n",(0,r.jsxs)(n.admonition,{type:"info",children:[(0,r.jsxs)(n.p,{children:["It's important to note that if you are running airgapped and you have already staged the operator image to your repository, you will need to update the image path in the ",(0,r.jsx)(n.code,{children:"operator.yaml"})," file. The below example uses ",(0,r.jsx)(n.code,{children:"sed"})," and updates every ",(0,r.jsx)(n.code,{children:"image:"})," entry."]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'sed -i "s/image:.*/image: \\"<REPO URL>\\/path\\/to\\/icp4a-content-operator:23.0.1-IF003\\"/" operator.yaml\n'})}),(0,r.jsxs)(n.p,{children:["This needs to be done ",(0,r.jsx)(n.strong,{children:"before"})," applying the ",(0,r.jsx)(n.code,{children:"operator.yaml"}),"!"]})]}),"\n",(0,r.jsx)(n.p,{children:"If you cannot run the deployment script, follow these steps to deploy the operator manually."}),"\n",(0,r.jsxs)(n.p,{children:["From the ",(0,r.jsx)(n.code,{children:"container-samples"})," directory:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"cd ibm-cp-fncm-case/inventory/fncmOperator/files/deploy/crs/container-samples\nkubectl apply -f ./descriptors/operator.yaml\n"})}),"\n",(0,r.jsx)(n.p,{children:"Wait for the operator to come back online after upgrading and completes its reconciliation."}),"\n",(0,r.jsx)(n.h3,{id:"upgrading-fncm-containers",children:"Upgrading FNCM containers"}),"\n",(0,r.jsx)(n.p,{children:"Once the operator has been upgraded, update your CR file to the latest image tags. You can also grab the latest CR from the case directory you extracted above:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"cd ibm-cp-fncm-case/inventory/fncmOperator/files/deploy/crs/container-samples/descriptors/ibm_fncm_cr_production_FC_content.yaml\n\n"})}),"\n",(0,r.jsx)(n.p,{children:"Now apply your updated CR to the cluster:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"kubectl apply -f ibm_fncm_cr_production.yaml\n"})}),"\n",(0,r.jsxs)(n.div,{children:[(0,r.jsxs)(n.p,{children:["As of 5.5.11, the ",(0,r.jsx)(n.code,{children:"add_repo_ce_wsi_url"})," was updated in the default CR shipped with that case. It no longer uses ",(0,r.jsx)(n.code,{children:"http"})," for access and now uses ",(0,r.jsx)(n.code,{children:"https"}),". So this must be taken into account if you are using an older CR that you've updated:"]}),(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"navigator_configuration.initialize_configuration.ic_icn_init_info.icn_repos"})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:' add_repo_ce_wsi_url: "http://{{ meta.name }}-cpe-stateless-svc.{{ meta.namespace }}.svc:9080/wsi/FNCEWS40MTOM/"\n'})}),(0,r.jsx)(n.p,{children:"Would now be"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'add_repo_ce_wsi_url: "https://{{ meta.name }}-cpe-stateless-svc.{{ meta.namespace }}.svc:9443/wsi/FNCEWS40MTOM/"\n'})})]}),"\n",(0,r.jsx)(n.h3,{id:"secret-menu-items",children:"Secret menu items"}),"\n",(0,r.jsxs)(n.admonition,{type:"info",children:[(0,r.jsxs)(n.p,{children:["As of ",(0,r.jsx)(n.a,{href:"https://www.ibm.com/support/pages/node/7032026",children:"23.0.1-IF003"})," the secret menu item for disabling readonly root fs on FNCM and BAN components is available. Simply add the following to your CR:"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"shared_configuration:\n  sc_disable_read_only_root_filesystem: true\n"})}),(0,r.jsx)(n.p,{children:"This helps when you have agents like Dynatrace that inject certain configs into each container rootfs as they come up."})]})]})}function p(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},1151:(e,n,t)=>{t.d(n,{Z:()=>s,a:()=>o});var r=t(7294);const i={},a=r.createContext(i);function o(e){const n=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);